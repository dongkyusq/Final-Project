'use client';

import React, { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import useAuthStore from '@/zustand/authStore';
import HeaderButton from './HeaderButton';

export default function Header() {
  const [searchInput, setSearchInput] = useState('');
  const [number, setNumber] = useState<number>(0);
  const router = useRouter();
  const { isLogin, logout, userId, userData, initializeAuthState, isLoading } = useAuthStore();

  useEffect(() => {
    const initialize = async () => {
      await initializeAuthState();
    };
    initialize();
  }, [initializeAuthState]);

  useEffect(() => {
    const num = Math.random() >= 0.5 ? 0 : 1;
    setNumber(num);
  }, []);

  const handleSearch = () => {
    if (searchInput.trim()) {
      router.push(`/search?query=${searchInput}`);
    }
  };

  const handleLogout = async () => {
    await fetch('/api/logout', {
      method: 'POST'
    });
    logout();
    router.replace('/');
  };

  return (
    <header className="h-[72px] flex items-center justify-between px-[120px] py-[16px] box-border">
      <div className="flex items-center gap-[32px]">
        <Link href="/">
          <div className="w-40 h-16 flex items-center justify-center">
            {number === 0 ? (
              <svg width="120" height="40" viewBox="0 0 120 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M5.72356 17.7405L5.70294 17.7199L13.3398 10.083C14.3148 9.108 15.9142 9.03488 16.9079 9.99113C17.9017 10.9474 17.9317 12.5768 16.9417 13.5668L11.3073 19.2011C10.8723 19.6361 10.8723 20.343 11.3073 20.778L16.8779 26.3486C17.8567 27.3274 17.9317 28.9343 16.9698 29.9261C15.9948 30.933 14.3861 30.9424 13.3998 29.9543L5.90544 22.4599C4.61169 21.1661 4.55356 19.1055 5.72544 17.7386L5.72356 17.7405Z"
                  fill="#253CE5"
                />
                <path
                  d="M99.7415 12.7646C100.067 11.5706 99.3626 10.3391 98.1687 10.0138C96.9747 9.6885 95.7431 10.3927 95.4179 11.5866L91.1546 27.235C90.8293 28.429 91.5335 29.6606 92.7274 29.9858C93.9214 30.3111 95.1529 29.6069 95.4782 28.413L99.7415 12.7646Z"
                  fill="#253CE5"
                />
                <path
                  d="M32.5883 22.3286C34.0245 22.3286 35.0989 23.6711 34.7595 25.0661C34.6039 25.7054 34.3976 26.2736 34.137 26.7705C32.9895 28.9023 31.0095 29.7404 27.612 29.7404C22.5945 29.7404 19.692 27.0742 19.6695 21.8204V19.3079C19.6245 14.1798 22.2795 11.6167 27.612 11.6167C31.1858 11.6167 33.4883 12.8879 34.5176 15.7154C35.0501 17.1761 33.9814 18.7248 32.427 18.7248H32.3726C31.4858 18.7248 30.6683 18.2036 30.3289 17.3842C29.8751 16.2873 29.0389 15.7548 27.567 15.7548C25.2945 15.7548 24.3945 16.8461 24.417 19.6642V21.5673C24.4395 24.4867 25.542 25.6286 27.792 25.6286C29.307 25.6286 30.0983 25.1261 30.4489 23.9317C30.7283 22.9829 31.5983 22.3286 32.5883 22.3286Z"
                  fill="#253CE5"
                />
                <path
                  d="M36.2463 24.5899V21.9349C36.2256 18.3349 38.0444 16.9624 41.9406 16.9624C45.7975 16.9849 47.5956 18.3574 47.575 21.9349V24.5899C47.5544 28.2124 45.6175 29.7424 41.8806 29.7424C38.1438 29.7424 36.265 28.2124 36.2463 24.5899Z"
                  fill="#253CE5"
                />
                <path
                  d="M48.7168 24.9273V21.7773C48.7168 20.6298 48.8968 19.7073 49.2343 19.0098C49.9093 17.6598 51.3718 17.0298 53.9593 17.0298H55.9618V15.9835C55.9618 14.7723 56.9443 13.7898 58.1555 13.7898C59.3668 13.7898 60.3493 14.7723 60.3493 15.9835V26.2398C60.3493 28.0004 58.9224 29.4273 57.1618 29.4273H53.3743C50.0668 29.4273 48.7168 28.0773 48.7168 24.9273Z"
                  fill="#253CE5"
                />
                <path
                  d="M67.7462 29.7404C63.7187 29.7404 61.4912 28.0304 61.4912 24.6779V22.4279C61.4912 18.5804 63.5837 16.9604 67.7462 16.9604C71.9087 16.9604 73.9562 18.8954 73.9562 22.6079C73.9693 23.8342 72.9775 24.8354 71.7512 24.8354H66.2275C65.7043 24.8354 65.3687 25.4298 65.6762 25.8536C66.0306 26.3411 66.6925 26.5698 67.7462 26.5698C68.6725 26.5698 69.3287 26.4179 69.6906 26.0354C70.0018 25.7054 70.4143 25.4898 70.8681 25.4898H72.0625C73.1237 25.4898 73.8137 26.6579 73.2531 27.5598C72.3362 29.0317 70.4031 29.7423 67.7481 29.7423L67.7462 29.7404ZM68.92 22.0473C69.5537 22.0473 69.8368 21.2542 69.3493 20.8492C68.9537 20.5211 68.3893 20.3392 67.7218 20.3392C66.9381 20.3392 66.3287 20.5154 65.9406 20.8848C65.5 21.3029 65.8018 22.0492 66.4093 22.0492H68.92V22.0473Z"
                  fill="#253CE5"
                />
                <path
                  d="M85.5028 23.5342V14.1029C85.5028 12.7286 86.6166 11.6167 87.9891 11.6167H88.0659C89.4403 11.6167 90.5522 12.7304 90.5522 14.1029V22.7298C90.5522 27.5073 88.1428 29.7404 82.8347 29.7404C77.5266 29.7404 75.1172 27.5336 75.1172 22.7298V14.1029C75.1172 12.7286 76.2309 11.6167 77.6034 11.6167C78.9778 11.6167 80.0897 12.7304 80.0897 14.1029V23.5604C80.0897 24.8842 81.0122 25.5592 82.8328 25.5592C84.6534 25.5592 85.4991 24.8842 85.4991 23.5342H85.5028Z"
                  fill="#253CE5"
                />
                <path
                  d="M40.0984 24.3276C41.2013 24.3276 42.0953 23.3068 42.0953 22.0476C42.0953 20.7884 41.2013 19.7676 40.0984 19.7676C38.9956 19.7676 38.1016 20.7884 38.1016 22.0476C38.1016 23.3068 38.9956 24.3276 40.0984 24.3276Z"
                  fill="white"
                />
                <path
                  d="M40.4245 22.8181C41.0241 22.8181 41.5101 22.2632 41.5101 21.5787C41.5101 20.8943 41.0241 20.3394 40.4245 20.3394C39.8249 20.3394 39.3389 20.8943 39.3389 21.5787C39.3389 22.2632 39.8249 22.8181 40.4245 22.8181Z"
                  fill="#253CE5"
                />
                <path
                  d="M43.7752 24.3276C44.878 24.3276 45.7721 23.3068 45.7721 22.0476C45.7721 20.7884 44.878 19.7676 43.7752 19.7676C42.6724 19.7676 41.7783 20.7884 41.7783 22.0476C41.7783 23.3068 42.6724 24.3276 43.7752 24.3276Z"
                  fill="white"
                />
                <path
                  d="M44.1012 22.8181C44.7008 22.8181 45.1869 22.2632 45.1869 21.5787C45.1869 20.8943 44.7008 20.3394 44.1012 20.3394C43.5017 20.3394 43.0156 20.8943 43.0156 21.5787C43.0156 22.2632 43.5017 22.8181 44.1012 22.8181Z"
                  fill="#253CE5"
                />
                <path
                  d="M55.8055 24.3276C56.9083 24.3276 57.8023 23.3068 57.8023 22.0476C57.8023 20.7884 56.9083 19.7676 55.8055 19.7676C54.7026 19.7676 53.8086 20.7884 53.8086 22.0476C53.8086 23.3068 54.7026 24.3276 55.8055 24.3276Z"
                  fill="white"
                />
                <path
                  d="M55.4792 22.8184C56.0787 22.8184 56.5648 22.2635 56.5648 21.579C56.5648 20.8945 56.0787 20.3396 55.4792 20.3396C54.8796 20.3396 54.3936 20.8945 54.3936 21.579C54.3936 22.2635 54.8796 22.8184 55.4792 22.8184Z"
                  fill="#253CE5"
                />
                <path
                  d="M52.1287 24.3276C53.2316 24.3276 54.1256 23.3068 54.1256 22.0476C54.1256 20.7884 53.2316 19.7676 52.1287 19.7676C51.0259 19.7676 50.1318 20.7884 50.1318 22.0476C50.1318 23.3068 51.0259 24.3276 52.1287 24.3276Z"
                  fill="white"
                />
                <path
                  d="M51.8024 22.8181C52.402 22.8181 52.8881 22.2632 52.8881 21.5787C52.8881 20.8943 52.402 20.3394 51.8024 20.3394C51.2028 20.3394 50.7168 20.8943 50.7168 21.5787C50.7168 22.2632 51.2028 22.8181 51.8024 22.8181Z"
                  fill="#253CE5"
                />
                <path
                  d="M114.276 17.7405L114.297 17.7199L106.66 10.083C105.685 9.108 104.086 9.03488 103.092 9.99113C102.098 10.9474 102.068 12.5768 103.058 13.5668L108.693 19.2011C109.128 19.6361 109.128 20.343 108.693 20.778L103.122 26.3486C102.143 27.3274 102.068 28.9343 103.03 29.9261C104.005 30.933 105.614 30.9424 106.6 29.9543L114.095 22.4599C115.388 21.1661 115.446 19.1055 114.275 17.7386L114.276 17.7405Z"
                  fill="#253CE5"
                />
              </svg>
            ) : (
              <svg width="120" height="40" viewBox="0 0 120 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M36.4992 25.3718H40.0767V23.7068C40.0767 22.4899 41.0629 21.5018 42.2817 21.5018C43.4986 21.5018 44.4867 22.4881 44.4867 23.7068V25.3718H51.8442C52.8267 25.3718 53.6217 26.1668 53.6217 27.1493C53.6217 28.1318 52.8267 28.9268 51.8442 28.9268H36.4992C35.5167 28.9268 34.7217 28.1318 34.7217 27.1493C34.7217 26.1668 35.5167 25.3718 36.4992 25.3718ZM36.1842 14.7293V13.2049C36.1842 12.0837 37.0936 11.1743 38.2148 11.1743H48.7504C50.5711 11.1743 52.0467 12.6499 52.0467 14.4706V21.1193C52.0467 22.3362 51.0604 23.3243 49.8417 23.3243C48.6248 23.3243 47.6367 22.3381 47.6367 21.1193V20.3768H38.1417C37.1592 20.3768 36.3642 19.5818 36.3642 18.5993C36.3642 17.6168 37.1592 16.8218 38.1417 16.8218H47.6367"
                  fill="#253CE5"
                />
                <path
                  d="M57.6383 21.7717H73.0058C73.9808 21.7717 74.7721 22.5629 74.7721 23.5379C74.7721 24.5129 73.9808 25.3042 73.0058 25.3042H71.8471V26.6654C71.8471 27.9517 70.8046 28.9942 69.5183 28.9942C68.2321 28.9942 67.1896 27.9517 67.1896 26.6654V25.3042H63.4321V26.6654C63.4321 27.9517 62.3896 28.9942 61.1033 28.9942C59.8171 28.9942 58.7746 27.9517 58.7746 26.6654V25.3042H57.6383C56.6633 25.3042 55.8721 24.5129 55.8721 23.5379C55.8721 22.5629 56.6633 21.7717 57.6383 21.7717ZM61.8496 15.8317L71.8958 16.7204C72.8352 16.8029 73.5552 17.5904 73.5552 18.5335C73.5552 19.5385 72.7396 20.3542 71.7346 20.3542H60.4808C58.7427 20.3542 57.3346 18.946 57.3346 17.2079V14.4573C57.3346 12.7192 58.7427 11.311 60.4808 11.311H70.7952C72.2577 11.311 73.4427 12.496 73.4427 13.9585V14.7985"
                  fill="#253CE5"
                />
                <path
                  d="M43.783 18.2182C44.8859 18.2182 45.7799 17.1974 45.7799 15.9382C45.7799 14.679 44.8859 13.6582 43.783 13.6582C42.6802 13.6582 41.7861 14.679 41.7861 15.9382C41.7861 17.1974 42.6802 18.2182 43.783 18.2182Z"
                  fill="white"
                />
                <path
                  d="M44.1091 16.7107C44.7086 16.7107 45.1947 16.1558 45.1947 15.4713C45.1947 14.7868 44.7086 14.2319 44.1091 14.2319C43.5095 14.2319 43.0234 14.7868 43.0234 15.4713C43.0234 16.1558 43.5095 16.7107 44.1091 16.7107Z"
                  fill="#253CE5"
                />
                <path
                  d="M47.4598 18.2182C48.5626 18.2182 49.4566 17.1974 49.4566 15.9382C49.4566 14.679 48.5626 13.6582 47.4598 13.6582C46.3569 13.6582 45.4629 14.679 45.4629 15.9382C45.4629 17.1974 46.3569 18.2182 47.4598 18.2182Z"
                  fill="white"
                />
                <path
                  d="M47.7868 16.7107C48.3864 16.7107 48.8724 16.1558 48.8724 15.4713C48.8724 14.7868 48.3864 14.2319 47.7868 14.2319C47.1872 14.2319 46.7012 14.7868 46.7012 15.4713C46.7012 16.1558 47.1872 16.7107 47.7868 16.7107Z"
                  fill="#253CE5"
                />
                <path
                  d="M64.2723 17.6447C65.3751 17.6447 66.2691 16.6239 66.2691 15.3647C66.2691 14.1055 65.3751 13.0847 64.2723 13.0847C63.1694 13.0847 62.2754 14.1055 62.2754 15.3647C62.2754 16.6239 63.1694 17.6447 64.2723 17.6447Z"
                  fill="white"
                />
                <path
                  d="M63.946 16.1372C64.5455 16.1372 65.0316 15.5823 65.0316 14.8978C65.0316 14.2133 64.5455 13.6584 63.946 13.6584C63.3464 13.6584 62.8604 14.2133 62.8604 14.8978C62.8604 15.5823 63.3464 16.1372 63.946 16.1372Z"
                  fill="#253CE5"
                />
                <path
                  d="M60.5955 17.6447C61.6984 17.6447 62.5924 16.6239 62.5924 15.3647C62.5924 14.1055 61.6984 13.0847 60.5955 13.0847C59.4927 13.0847 58.5986 14.1055 58.5986 15.3647C58.5986 16.6239 59.4927 17.6447 60.5955 17.6447Z"
                  fill="white"
                />
                <path
                  d="M60.2692 16.137C60.8688 16.137 61.3548 15.5821 61.3548 14.8976C61.3548 14.2131 60.8688 13.6582 60.2692 13.6582C59.6697 13.6582 59.1836 14.2131 59.1836 14.8976C59.1836 15.5821 59.6697 16.137 60.2692 16.137Z"
                  fill="#253CE5"
                />
                <path
                  d="M84.2013 9.80836L84.0891 9.7778C82.9262 9.46096 81.7265 10.1469 81.4097 11.3099L77.1158 27.0704C76.799 28.2334 77.4849 29.433 78.6479 29.7499L78.76 29.7804C79.923 30.0973 81.1227 29.4113 81.4395 28.2484L85.7334 12.4878C86.0502 11.3248 85.3643 10.1252 84.2013 9.80836Z"
                  fill="#253CE5"
                />
                <path
                  d="M99.0722 17.8475L99.0928 17.8269L91.409 10.1432C90.599 9.33316 89.3334 9.14379 88.3546 9.73816C86.8978 10.6232 86.7309 12.5488 87.854 13.6719L93.5296 19.3475C93.9421 19.76 93.9421 20.4294 93.5296 20.8419L87.8709 26.5007C87.059 27.3125 86.8678 28.5838 87.4659 29.5644C88.3528 31.0175 90.2746 31.1825 91.3978 30.0613L98.8922 22.5669C100.186 21.2732 100.244 19.2125 99.0722 17.8457V17.8475Z"
                  fill="#253CE5"
                />
                <path
                  d="M20.9267 17.847L20.9061 17.8264L28.5936 10.1389C29.3604 9.37204 30.5436 9.14892 31.5017 9.65704C33.0898 10.5008 33.3054 12.5145 32.1467 13.6733L26.4711 19.3489C26.0586 19.7614 26.0586 20.4308 26.4711 20.8433L32.1298 26.502C32.9417 27.3139 33.1329 28.5852 32.5348 29.5658C31.6479 31.0189 29.7261 31.1839 28.6029 30.0627L21.1086 22.5683C19.8148 21.2745 19.7567 19.2139 20.9286 17.847H20.9267Z"
                  fill="#253CE5"
                />
              </svg>
            )}
          </div>
        </Link>
        <nav className="ml-4 space-x-[12px]">
          <a href="#" className="text-grey-700 px-[12px] py-[8px]">
            Q&A
          </a>
          <a href="#" className="text-grey-700 px-[12px] py-[8px]">
            인사이트
          </a>
          <Link href="/pro" className="text-grey-700 px-[12px] py-[8px]">
            전문가 의뢰
          </Link>
        </nav>
      </div>

      {/* 검색창 */}
      <div className="w-[340px] h-[40px] flex justify-between bg-grey-50 rounded-[20px] px-[16px] py-[8px]">
        <input
          type="text"
          placeholder="도움이 필요한 언어, 주제를 찾아보세요."
          className="bg-grey-50 outline-none w-[238px] h-[24px] placeholder-grey-200 placeholder:text-[13px] text-black text-[15px]"
          value={searchInput}
          onChange={(e) => setSearchInput(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
        />
        <button onClick={handleSearch}>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M17 16.2916C18.2447 14.8814 19 13.0289 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19C13.3894 19 15.5341 17.9525 17 16.2916ZM17 16.2916L21.7084 21"
              stroke="black"
              stroke-linecap="round"
            />
          </svg>
        </button>
      </div>

      {/* 로그인 및 회원가입 */}
      {/* <HeaderButton /> */}
      {isLogin ? (
        <div className="flex items-center gap-[24px]">
          <div className="flex gap-[12px]">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M8.5 8.56061H13.5M8.5 12.0006H15.5M7.44365 17.4961L8.60481 18.7851C9.19374 19.4389 10.2164 19.4477 10.8164 18.8041L12.0538 17.4771C12.3375 17.1728 12.7348 17 13.1509 17H18.5C19.3284 17 20 16.3284 20 15.5V5.5C20 4.67157 19.3284 4 18.5 4H5.5C4.67157 4 4 4.67157 4 5.5V15.5C4 16.3284 4.67157 17 5.5 17H6.32914C6.75415 17 7.1592 17.1803 7.44365 17.4961Z"
                stroke="black"
                stroke-linecap="round"
              />
            </svg>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M9.25 20.5C9.25 20.5 10.097 21.5 12 21.5C13.903 21.5 14.75 20.5 14.75 20.5M5.68328 12.6334L3.72361 16.5528C3.39116 17.2177 3.87465 18 4.61803 18H19.382C20.1253 18 20.6088 17.2177 20.2764 16.5528L18.3167 12.6334C18.1084 12.2169 18 11.7575 18 11.2918V9C18 5.68629 15.3137 3 12 3V3C8.68629 3 6 5.68629 6 9V11.2918C6 11.7575 5.89156 12.2169 5.68328 12.6334Z"
                stroke="black"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </div>
          <div className="flex items-center gap-[24px]">
            <Link href={`/mypage/${userId}`}>
              <b className="text-primary-500">{userData?.name || userData?.user_name}</b>님
            </Link>
            <button onClick={handleLogout} className="border border-black text-black px-4 py-2 rounded">
              로그아웃
            </button>
          </div>
        </div>
      ) : (
        <div className="flex items-center gap-[32px]">
          <Link href="/login" className="text-black px-4 py-2 rounded">
            로그인
          </Link>
          <Link
            href="/signup"
            className="bg-primary-500 hover:bg-primary-700 text-white px-[16px] py-[8px] rounded-[8px]"
          >
            회원가입
          </Link>
        </div>
      )}
    </header>
  );
}
